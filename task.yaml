version: v1.1.0
stepTimeout: 3600
steps:
    - cmd: >-
          {{.Run.Registry}}/buildx
          build --push
          -t {{.Run.Registry}}/{{.Values.REPOSITORY_NAME}}:{{.Run.ID}}
          --cache-from={{.Run.Registry}}/{{.Values.REPOSITORY_NAME}}:cache
          --cache-to=type=registry,ref={{.Run.Registry}}/{{.Values.REPOSITORY_NAME}}:cache,mode=max
          {{.Values.BUILD_CONTEXT}}

    az acr run -r akgha -f task.yaml \
    --set BUILD_CONTEXT=https://github.com/akalfas/wknd.git \
    --set REPOSITORY_NAME=wknd \
    /dev/null
